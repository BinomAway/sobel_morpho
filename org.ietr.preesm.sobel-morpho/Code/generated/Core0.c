/**
 * @file Core0.c
 * @generated by CPrinter
 * @date Fri Dec 01 11:00:16 CET 2023
 *
 * Code generated for processing element Core0 (ID=0).
 */

#include "preesm_gen.h"
// Core Global Declaration
extern pthread_barrier_t iter_barrier;
extern int preesmStopThreads;

#ifdef PREESM_MD5_UPDATE
extern struct rk_sema preesmPrintSema;
#endif

// Core Global Definitions
char Core0[3110400]; //  size:= 3110400*char
char Shared[4224040]; //  size:= 4224040*char
char *const Read_YUV_0__Split_0__0 = (char*) (Core0 + 0);  // Read_YUV_0 > Split_0 size:= 2073600*char
char *const Read_YUV_0__display_0__0 = (char*) (Core0 + 2073600);  // Read_YUV_0 > display_0 size:= 1036800*char
char *const Sobel_0__Dilation_0__0 = (char*) (Core0 + 0);  // Sobel_0 > Dilation_0 size:= 533760*char
char *const Dilation_0__Erosion_0__0 = (char*) (Core0 + 533760);  // Dilation_0 > Erosion_0 size:= 526080*char
char *const Split_0__explode_Split_0_output__0 = (char*) (Shared + 16); // Split_0 > explode_Split_0_output size:= 2150400*char
char *const explode_Split_0_output__Sobel_0__0 = (char*) (Shared + 16); // explode_Split_0_output > Sobel_0 size:= 537600*char
char *const explode_Split_0_output__Sobel_1__0 = (char*) (Shared + 537616); // explode_Split_0_output > Sobel_1 size:= 537600*char
char *const explode_Split_0_output__Sobel_2__0 = (char*) (Shared + 1075216); // explode_Split_0_output > Sobel_2 size:= 537600*char
char *const explode_Split_0_output__Sobel_3__0 = (char*) (Shared + 1612816); // explode_Split_0_output > Sobel_3 size:= 537600*char
char *const implode_display_0_y__display_0__0 = (char*) (Shared + 2150432); // implode_display_0_y > display_0 size:= 2073600*char
char *const Erosion_0__implode_display_0_y__0 = (char*) (Shared + 2150432); // Erosion_0 > implode_display_0_y size:= 518400*char
char *const Erosion_2__implode_display_0_y__0 = (char*) (Shared + 3187232); // Erosion_2 > implode_display_0_y size:= 518400*char
char *const Erosion_1__implode_display_0_y__0 = (char*) (Shared + 537616); // Erosion_1 > implode_display_0_y size:= 518400*char
char *const Erosion_3__implode_display_0_y__0 = (char*) (Shared + 1612816); // Erosion_3 > implode_display_0_y size:= 518400*char
uchar *const y__input__0 = (uchar*) (Core0 + 0);  // Read_YUV_0_y > Split_0_input size:= 2073600*uchar
uchar *const u__u__0 = (uchar*) (Core0 + 2073600);  // Read_YUV_0_u > display_0_u size:= 518400*uchar
uchar *const v__v__0 = (uchar*) (Core0 + 2592000);  // Read_YUV_0_v > display_0_v size:= 518400*uchar
uchar *const output__input__0 = (uchar*) (Core0 + 0);  // Sobel_0_output > Dilation_0_input size:= 533760*uchar
uchar *const output__input__1 = (uchar*) (Core0 + 533760);  // Dilation_0_output > Erosion_0_input size:= 526080*uchar
uchar *const output__input__2 = (uchar*) (Shared + 16); // Split_0_output > explode_Split_0_output_input size:= 2150400*uchar
uchar *const output_0__input__0 = (uchar*) (Shared + 16); // explode_Split_0_output_output_0 > Sobel_0_input size:= 537600*uchar
uchar *const output_1__input__0 = (uchar*) (Shared + 537616); // explode_Split_0_output_output_1 > Sobel_1_input size:= 537600*uchar
uchar *const output_2__input__0 = (uchar*) (Shared + 1075216); // explode_Split_0_output_output_2 > Sobel_2_input size:= 537600*uchar
uchar *const output_3__input__0 = (uchar*) (Shared + 1612816); // explode_Split_0_output_output_3 > Sobel_3_input size:= 537600*uchar
uchar *const output__y__0 = (uchar*) (Shared + 2150432); // implode_display_0_y_output > display_0_y size:= 2073600*uchar
uchar *const output__y_0__0 = (uchar*) (Shared + 2150432); // Erosion_0_output > implode_display_0_y_y_0 size:= 518400*uchar
uchar *const output__y_2__0 = (uchar*) (Shared + 3187232); // Erosion_2_output > implode_display_0_y_y_2 size:= 518400*uchar
uchar *const output__y_1__0 = (uchar*) (Shared + 537616); // Erosion_1_output > implode_display_0_y_y_1 size:= 518400*uchar
uchar *const output__y_3__0 = (uchar*) (Shared + 1612816); // Erosion_3_output > implode_display_0_y_y_3 size:= 518400*uchar

void* computationThread_Core0(void *arg) {
  if (arg != NULL) {
    printf("Warning: expecting NULL arguments\n");
    fflush (stdout);
  }

#ifdef PREESM_MD5_UPDATE
	PREESM_MD5_CTX preesm_md5_ctx_u__u__0;
	PREESM_MD5_Init(&preesm_md5_ctx_u__u__0);
	PREESM_MD5_CTX preesm_md5_ctx_v__v__0;
	PREESM_MD5_Init(&preesm_md5_ctx_v__v__0);
	PREESM_MD5_CTX preesm_md5_ctx_output__y__0;
	PREESM_MD5_Init(&preesm_md5_ctx_output__y__0);
#endif
  // Initialisation(s)
  initReadYUV(1920/*width*/, 1080/*height*/); // Read_YUV_0

  yuvDisplayInit(0/*id*/, 1920/*width*/, 1080/*height*/); // display_0

  // Begin the execution loop
  pthread_barrier_wait(&iter_barrier);
#ifdef PREESM_LOOP_SIZE // Case of a finite loop
	int index;
	for(index=0;index<PREESM_LOOP_SIZE && !preesmStopThreads;index++){
#else // Default case of an infinite loop
  while (!preesmStopThreads) {
#endif
    // loop body
    readYUV(1920/*width*/, 1080/*height*/, y__input__0, u__u__0, v__v__0); // Read_YUV_0

    split(4/*nbSlice*/, 1920/*width*/, 1080/*height*/, 5/*overlap*/, y__input__0, output__input__2); // Split_0

    // Fork explode_Split_0_output

    {
    }
    sendStart(0, 1); // Core0 > Core1
    sendEnd(); // Core0 > Core1
    sendStart(0, 3); // Core0 > Core3
    sendEnd(); // Core0 > Core3
    sendStart(0, 2); // Core0 > Core2
    sendEnd(); // Core0 > Core2
    sobel(1920/*width*/, 280/*height*/, output_0__input__0, output__input__0); // Sobel_0

    dilation(278/*height*/, 1920/*width*/, 2/*window*/, output__input__0, output__input__1); // Dilation_0

    erosion(274/*height*/, 1920/*width*/, 2/*window*/, output__input__1, output__y_0__0); // Erosion_0

    receiveStart(); // Core1 > Core0
    receiveEnd(1, 0); // Core1 > Core0
    receiveStart(); // Core3 > Core0
    receiveEnd(3, 0); // Core3 > Core0
    receiveStart(); // Core2 > Core0
    receiveEnd(2, 0); // Core2 > Core0
    // Join implode_display_0_y

    {
      memcpy(output__y__0 + 518400, output__y_1__0 + 0, 518400); // 518400 * uchar
      memcpy(output__y__0 + 1555200, output__y_3__0 + 0, 518400); // 518400 * uchar
    }
    yuvDisplay(0/*id*/, output__y__0, u__u__0, v__v__0); // display_0
#ifdef PREESM_MD5_UPDATE
		PREESM_MD5_Update(&preesm_md5_ctx_u__u__0,(char *)u__u__0, 518400);
		PREESM_MD5_Update(&preesm_md5_ctx_v__v__0,(char *)v__v__0, 518400);
		PREESM_MD5_Update(&preesm_md5_ctx_output__y__0,(char *)output__y__0, 2073600);
		#endif

    // loop footer
    pthread_barrier_wait(&iter_barrier);

  }

#ifdef PREESM_MD5_UPDATE
	// Print MD5
	rk_sema_wait(&preesmPrintSema);
	unsigned char preesm_md5_chars_final[20] = { 0 };
	PREESM_MD5_Final(preesm_md5_chars_final, &preesm_md5_ctx_u__u__0);
	printf("preesm_md5_u__u__0 : ");
	for (int i = 16; i > 0; i -= 1){
		printf("%02x", *(preesm_md5_chars_final + i - 1));
	}
	printf("\n");
	fflush(stdout);
	PREESM_MD5_Final(preesm_md5_chars_final, &preesm_md5_ctx_v__v__0);
	printf("preesm_md5_v__v__0 : ");
	for (int i = 16; i > 0; i -= 1){
		printf("%02x", *(preesm_md5_chars_final + i - 1));
	}
	printf("\n");
	fflush(stdout);
	PREESM_MD5_Final(preesm_md5_chars_final, &preesm_md5_ctx_output__y__0);
	printf("preesm_md5_output__y__0 : ");
	for (int i = 16; i > 0; i -= 1){
		printf("%02x", *(preesm_md5_chars_final + i - 1));
	}
	printf("\n");
	fflush(stdout);
	rk_sema_post(&preesmPrintSema);
#endif

  return NULL;
}

